<!DOCTYPE html>
<html  xml:lang="en" lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>GlassFish Wiki : Modularity Tools</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="" />
        <meta http-equiv="content-language" content="en" />
        <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap.min.css" rel="stylesheet" />
        <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
        <link href="styles/docs.css" rel="stylesheet" />
        <link href="styles/site1.css" rel="stylesheet" />
        <style> a { color: #555555; } </style>
        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
                <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>

    <body class="page-documentation project-gfmvnsite" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <div class="brand"><a href="/glassfish/index.html"><img src="../images/gflogo24.png"><span style="color:#E88A43;font-size:18px;padding-left:11px;padding-top:15px;font-weight:bold;">GlassFish</span> - <span style="font-size:18px;" class="gf-grey">World's first Java EE 7 Application Server</span></a></div>
                    <div class="nav-collapse">
                        <ul class="nav pull-right">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
									<li><a href="/glassfish/LICENSE" title="License">Legal </a></li>
									<li><a href="/glassfish/CONTRIBUTING" title="Contributing">Contributing </a></li>
                                </ul>
                            </li>
                        </ul>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <br/><br/>
        <div class="container"><body> 
 <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff"> 
  <tbody>
   <tr> 
    <td valign="top" class="pagebody">   <h4><a name="ModularityTools-Introduction"></a>Introduction</h1> <p>These are light weight tools developed in leisure to be able to generate some metrics related to module states, startup time and memory consumption of GlassFish distributions. The module modularity-scripts contain simple shell scripts that help generate reports on few metrics using glassfish distro. The dependency-analyser module generates a report by analysing the dependencies among OSGI modules and the packages that wire them together. The graphic visualizer tool generates directed graphs which depict dependencies among OSGI bundles using the wires.xml and bundles.xml that is generated by dependency-analyser module.</p> <h4><a name="ModularityTools-DownloadTools"></a>Download Tools</h1> <p>&nbsp;The modularity tools are available at the following location. Please check out your local svn copy from here.</p> <p>&nbsp; <a href="https://svn.java.net/svn/glassfish~svn/trunk/modularity-tools">https://svn.java.net/svn/glassfish~svn/trunk/modularity-tools</a></p> <h4><a name="ModularityTools-%26nbsp%3BInstructions"></a>&nbsp;Instructions</h1> <h4><a name="ModularityTools-%26nbsp%3BModularityScripts"></a>&nbsp;Modularity-Scripts</h2> <h5><a name="ModularityTools-cd.%2Fmodularitytools%2Fmodularityscripts"></a><b>cd ./modularity-tools/modularity-scripts</b></h5> <p>The scripts contained here are used to collect statistics on paramaeters like number of OSGI modules and their states, startup time and the memory consumed when any distribution of glassfish is run.</p> <p>Below is a brief explanation on how to run the scripts and the expected parameters to be provided.</p> <p>GF_HOME = Glassfish home to the depth ~/../../glassfish3/glassfish<br> TARGET_DIRECTORY = Directory path where results need to be populated<br> STATS_XML_FILE_NAME = XML file name for collecting OSGI module statistics<br> TIME_XML_FILE_NAME = XML file name for collecting startup time statistics<br> MEMORY_XML_FILE_NAME = XML file name for collecting memory statistics<br> LOG_FILE_NAME = log file name<br> APP_PATH = path to the archive that needs to be deployed (Sample Applications are bundled in the source under scripts directory)<br> ID = Any unique identifier for the run<br> FILE_NAME_MATCH = match the file name for which aggregate report is needed<br> TYPE = type for which report is needed; allowed types are "MODULE/TIME/MEMORY/STATE"<br> OUTPUT_DIR = output directory for aggregated reports<br> OUTPUT_XML_FILE_NAME = file name for aggregated report<br> OUTPUT_HTML_FILE_NAME = file name for HTML graph visulaization</p> <p>1. startup_stats.sh</p> <p>The script collects parameters on OSGI modules, startup time and memory when Glassfish starts up.</p> <p>Usage: ./startup_stats.sh GF_HOME ID(REVISION) TARGET_DIRECTORY STATS_XML_FILE_NAME TIME_XML_FILE_NAME MEMORY_XML_FILE_NAME LOG_FILE_NAME</p> <p>2. deploy_stats.sh</p> <p>The script collects parameters on OSGI modules, deployment time and memory when an application is deployed.</p> <p>Usage: ./deploy_stats.sh GF_HOME ID(REVISION) TARGET_DIRECTORY STATS_XML_FILE_NAME TIME_XML_FILE_NAME MEMORY_XML_FILE_NAME LOG_FILE_NAME APP_PATH</p> <p>3. generate_xml_html.sh</p> <p>The script collects parameters from all previous runs and prepares a summary HTML report of all parameters and also graphic visualization of the same.</p> <p>Usage: ./generate_xml_html.sh TARGET_DIRECTORY FILE_NAME_MATCH TYPE OUTPUT_DIR OUTPUT_XML_FILE_NAME OUTPUT_HTML_FILE_NAME</p> <p>Sample Applications are also bundled here for usage with script deploy_stats.sh. The bundled applications includes a simple webapp, an EJB app and also a full fledged enterprise application.</p> <h4><a name="ModularityTools-%26nbsp%3BDependencyAnalyser"></a>&nbsp;Dependency-Analyser</h2> <h5><a name="ModularityTools-cd.%2Fmodularitytools%2Fdependencyanalyser"></a><b>cd ./modularity-tools/dependency-analyser</b></h5> <p>To analyse OSGi metadata of various bundles in a glassfish distribution.&nbsp;</p> <p>mvn clean install</p> <p>&nbsp;./run-package-analyser.sh path-to-glassfish-modules-directory bundles.xml wires.xml duplicate.txt unused.txt<br> &nbsp;<br> where,<br> &nbsp;<br> 1) bundles.xml: For each bundle, it contains symbolic name, exported package details and imported package details. Exported packages are further divided into two segments: used and unused. If an exported package is not imported by any other module than the exporter, it is considered an unused package.<br> 2) duplicate.txt: Contains packages that are duplicated in various bundles.</p> <p>3) wires.xml: Tries to match importers with exporters. There is a wires.xsl as well. So, if you open this file in a browser, you will get a nice tabular report. The wiring details may not be totally correct, because I just try to match package names without considering version constraint or attribute matching.</p> <p>4) unused.txt: Contains list of exported packages that are never imported by anyone other the exporting bundle. We have quite a large number of such packages (do a wc on the file to know the number). As I write, almost two thirds of our exported packages are unused. <br class="atl-forced-newline"> <br class="atl-forced-newline"></p> <p><b>Maven Plugin</b></p> <p>The tool is part of modularity-maven-plugin. The goal name is analyse-packages. To invoke the maven plugin, you need to use one of the distribution (e.g., nucleus/web/glassfish) pom.xml.</p> <p>e.g.&nbsp;&nbsp; mvn -f /space/workspace/glassfish/trunk/main/appserver/distributions/glassfish/pom.xml org.glassfish.modularity:modularity-maven-plugin:analyse-packages</p> <p>For more information on this module please read this wiki page:&nbsp;<a href="./OsgiPkgDepAnalyser.html">https://wikis.oracle.com/display/GlassFish/OsgiPkgDepAnalyser</a></p> <h4><a name="ModularityTools-%26nbsp%3BDependencyVisualizer"></a>&nbsp;Dependency-Visualizer</h2> <p>This module reads a wires.xml and bundles.xml file generated by the dependency-analyser and outputs a dot file. Uses [GraphViz](<a href="http://www.graphviz.org/">http://www.graphviz.org/</a>) to create images from the generated dot file. The tool helps visualizing the wiring dependencies between packages.The tool also supports viewing the dependencies of only a subset of the packages, a set of modules given in a file as input, a single module by name and also a an XML file report containing metrics.</p> <p>*To use the tool*<br> 0. Install graphviz(<a href="http://www.graphviz.org/">http://www.graphviz.org/</a>) in your machine.<br> 1. Follow the steps below:</p> <p>&nbsp;&nbsp;&nbsp; - run mvn clean install</p> <p>&nbsp;&nbsp; - run mvn assembly:assembly to generate the visualizer jar</p> <p>&nbsp;&nbsp;&nbsp; - generate a wires.xml and bundles.xml using the dependency-verifier project for the modules that needs to be analyzed<br> &nbsp;&nbsp;</p> <p>&nbsp;To visualize the dependencies of packages that have the word "web" in them,</p> <p>run "./subset.sh web".</p> <p>&nbsp;To visualize the dependencies among a set of bundles either within themselves or the rest of the bundles use options set/all like below. Please note the module names in file should be new line separated.</p> <p>run "./file.sh file_name set/all"</p> <p>&nbsp;To visualize the dependencies&nbsp; of a bundle with other bundles use options imports/exports/both with script below below.</p> <p>run "./module.sh module_name imports/exports/both"</p> <p>&nbsp;To generate an XML report containing a number of useful metrics run the script below.</p> <p>run "./generateXML.sh"</p> <p>&nbsp;To draw diagrams for all bundles in given wires.xml; collect all module names in a file named "ModuleNames.txt" and run the script below. You can easily collect all module names by using the following command ./../glassfish4/glassfish/bin/asadmin list-modules | grep 'OSGiModuleImpl:: Bundle' | sed "s/^.<b>Bundle = [//" | sed "s/ [.</b>$//" &gt; ModuleNames.txt</p> <p>run "./DrawAll.sh"</p> <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p> </td> 
   </tr> 
  </tbody>
 </table>    
</body></div>
        <br/>

        <!-- footer================================================== -->
        <footer class="well">
            <div class="container">

                <div class="row-fluid" id="bottom-info">
                    <!--div class="span6 pagination-centered" id="social"-->
                    <div class="span4" id="social">			
                        <a href="http://blogs.oracle.com/theaquarium/"><img src="../images/icons/TheAquarium.png"></a>
                        <a href="https://twitter.com/glassfish"><img src="../images/icons/twitter.png"></a>
                        <a href="https://plus.google.com/communities/106098646151660933759"><img src="../images/icons/google.png"></a>
                        <a href="http://www.linkedin.com/groups/GlassFish-Users-106819/about"><img src="../images/icons/linkedin.png"></a>
                        <a href="http://www.youtube.com/user/GlassFishVideos"><img src="../images/icons/youtube.png"></a>
                        <a href="https://www.facebook.com/GlassFish"><img src="../images/icons/facebook.png"></a>
                    </div>

                    <div class="span8" id="copyright">Page last changed on Apr 26, 2013 by 
<font color="#0050B2">16468</font>. Exported from wikis.oracle.com on May 27, 2015 20:46.<br/>
                        Copyright &copy; 2005-2015 Oracle Corporation and/or its affiliates.</div>
                </div>
            </div>
        </footer>

        <!-- ================================================== -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/bootstrap-tab.js"></script>
	<script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
	<!--  Begin SiteCatalyst code  -->
  	<!--  End SiteCatalyst code  -->
    </body>
</html>